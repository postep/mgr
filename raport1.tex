\documentclass[a4paper]{article}
\usepackage{polski}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{geometry}
\usepackage{float}

\newcommand{\matr}[1]{\mathbf{#1}} % undergraduate algebra version

\graphicspath{{./img/}}

\title{MGR - Raport 1}
\author{Jakub Postępski}

\begin{document}

\maketitle

\section{Problem}
Należy skompensować siłę grawitacji w układzie ze sprężyną. Rozwiązaniem jest określenie masy a następnie dodanie odpowiednich sił do układu w celu kompensacji siły grawitacji.

\section{Obiekt}
Obiektem jest układ ze sprężyną i amortyzatorem. Na końcu zawieszona jest punktowa masa $m$ której grawitację należy skompensować. Przyjmujemy że dla użytkownika dostępne są pomiary położenia ($x$), prędkości ($\dot{x}$), przyspieszenia ($\ddot{x}$) oraz siły odczytanej przez czujnik.

Model obiektu można opisać układem równań różniczkowych:

\begin{equation}
	\begin{bmatrix}
	    \dot{x} \\
	    \ddot{x}
	\end{bmatrix}
	=
	\begin{bmatrix}
	    0 & 1 \\
	    \frac{k}{m} & \frac{b}{m}
	\end{bmatrix}
	\begin{bmatrix}
		x \\
	    \dot{x}
	\end{bmatrix}
	+
	\begin{bmatrix}
	    0 \\
	    1
	\end{bmatrix}
	{-g + u_w}
\end{equation}

gdzie:
\begin{itemize}
	\item $x$ pozycja zawieszonej masy
	\item $k$ parametr sztywności
	\item $b$ parametr amortyzacji
	\item $m$ masa przedmiotu
	\item $g$ przyspieszenie ziemskie
	\item $u_w$ przyspieszenie które można zewnętrznie dodać do układu
\end{itemize}

Układ możemy więc zapisać w standardowej postaci
\begin{equation}
\dot{x} = \textbf{A}x + \textbf{B}u(t)
\end{equation}
gdzie:
\begin{equation}
\mathbf{A} = 	\begin{bmatrix}
	    0 & 1 \\
	    \frac{k}{m} & \frac{b}{m}
	\end{bmatrix}
\end{equation}
oraz:
\begin{equation}
\mathbf{B} = \begin{bmatrix}
	    0 \\
	    1
	\end{bmatrix}
\end{equation}

Po zdyskretyzowaniu z okresem próbkowania $t$ otrzymujemy układ:
\begin{equation}
x(k+1) = \mathbf{A_d}x(k) + \mathbf{B}_du(k)
\label{eq:dyskretny}
\end{equation}


Symulację obiektu (rys. \ref{fig:system}) można wykonać korzystając z wersji dyskretnej układu. Czujnik siły można zasymulować biorąc przyspieszenie układu $\ddot{x}$ i mnożąć przez masę. W celu symulacji zakłóceń w każdym kroku symulacji zmiennych stanu układu dodawany jest szum biały.

\begin{figure}[H]
	\includegraphics[width=0.99\linewidth]{system_sys}
	\centering
	\caption{Symulacja układu z parametrami $T=0.01$, $k = 20$, $b = 1$, $m = 3$.}
	\label{fig:system}
\end{figure}

\section{Estymacja masy}
Estymacja masy działa na podstawie dwóch modeli. Model opisany w sekcji \ref{fs} działa dobrze gdy układ jest ustabilizowany. Model opisany w sekcji \ref{pos} działa dobrze gdy układ jest w ruchu. W celu poprawnej estymacji w dowolnym momencie pracy układu połączono dane z modeli przy wykorzystaniu logiki rozmytej (rys. \ref{fig:system_mass}). Następnie zastosowano filtr dolnoprzepustowy w celu odfitrowania zakłóceń.
  
\begin{figure}[H]
	\includegraphics[width=0.99\linewidth]{system_mass}
	\centering
	\caption{Estymacja masy układu z parametrami $T=0.01$, $k = 20$, $b = 1$, $m = 3$. Linią $W$ oznaczono poziom funkcji przynależności modelu }
	\label{fig:system_mass}
\end{figure}

\subsection{Estymacja z czujnika siły}
\label{fs}
Siła odczytywana z czujnika siły jest sumą sił działających na masę. Kiedy masa się nie porusza w łatwy sposób można odczytać siłę grawitacji. W momencie ruchu układu z czujnika dostajemy sygnał zmienny. W celu uzyskania interesującej nas składowej stałej (siła grawitacji) możemy zastosować transformatę Fouriera. Jedną z własności tej transformaty jest fakt że uzyskana składowa stała jest średnią arytmetyczną sygnału. W praktyce w celu uzyskania siły grawitacji stosowana jest średnia krocząca która działa podobnie do filtru dolnoprzepustowego. Dodatkową zaletą zastosowania filtru odfiltrowywanie szumów pomiarowych.

\subsection{Estymacja z macierzy układu}
\label{pos}
Ponieważ macierz $\mathbf{B}$ ma tylko jeden wyraz różny od zera $\mathbf{B_d}$ jest uzyskiwana w prosty sposób i można przyjąć że:
\begin{equation}
\mathbf{B_d} = \mathbf{B}t
\end{equation} 
Przekształcając równanie \ref{eq:dyskretny} i stosując pseudoinwersję macierzy otrzymujemy równanie macierzowe:
\begin{equation}
	\mathbf{A_d} = (X(k+1) - \mathbf{B}_du(k))(X(k))^{pinv}
	\label{eq:pinv}
\end{equation}
przy założeniu $n$ ostatnich próbek zmiennych stanów ukłądu
\begin{equation}
	X(k) = 	\begin{bmatrix}
		    x(k) & x(k-1)  & ... & x(k-n) 
		\end{bmatrix}
	\label{eq:xk}
\end{equation}

Po obliczeniu estymacji $\mathbf{A_d}$ metodą ZOH wyliczamy estymację macierzy $\mathbf{A}$ otrzymując macierz
\begin{equation}
\mathbf{\hat{A}} = 	\begin{bmatrix}
	    a_{11} & a_{12}\\
	    a_{21} & a_{22}
	\end{bmatrix}
\end{equation} 
Po przyrównaniu jej do macierzy $\mathbf{A}$ możemy wyliczć masę z równań:
\begin{equation}
\hat{m_1} = \frac{-k}{a_{21}}
\end{equation}
\begin{equation}
\hat{m_2} = \frac{-b}{a_{22}}
\end{equation}

i ostatecznie przyjąć estymację:
\begin{equation}
\hat{m} = \frac{\hat{m_1}+\hat{m_2}}{2}
\end{equation}


W trakcie symulacji eksperymentowano z różną ilością próbek stosowanych do estymacji (rys. .. ). Ostatecznie przyjęto $n = 100$ (rys. ).

\section{Kompensacja grawitacji}
Kompensacja polega na dodaniu do układu siły która przeciwdziała sile grawitacji masy. Pomijając niedokładności, układ ze skompensowaną siłą grawitacji zachowuje się tak jakby tej masy w układzie nie było. Nie powstają oscylacje, a układ stabilizuje się bardzo szybko w pożądanej pozycji.




\end{document}